rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // USERS COLLECTION
    // NOTE: Because you are using Supabase for Authentication but Firebase for the Database,
    // the standard `request.auth` variable will be null in these rules.
    // To secure this in production, you would need to mint a custom Firebase Token 
    // using your Supabase User ID on your backend.
    
    // For now, to make the client-side signup work, we allow access to the specific user document.
    match /users/{userId} {
      // Allow reading user profiles publicly (needed for verifying existing users etc)
      allow read: if true;
      
      // Allow creating/updating a user document
      // We add a basic check that the document ID matches the uid field in the data
      allow write: if request.resource.data.uid == userId;
    }

    // Default deny for all other collections
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
